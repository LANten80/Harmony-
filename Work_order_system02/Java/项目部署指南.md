# Java后端项目部署指南

## 文件清单

### 1. 数据库相关
- `database/init.sql` - 数据库初始化脚本
- `MySQL数据库设计文档.md` - 数据库设计文档

### 2. 项目配置文件
- `pom.xml` - Maven依赖配置
- `src/main/resources/application.yml` - Spring Boot配置文件

### 3. Java源代码
- **启动类**: `WorkOrderSystemApplication.java`
- **配置类**: `SecurityConfig.java`, `WebConfig.java`
- **实体类**: `User.java`, `Task.java`, `UserToken.java`
- **Repository**: `UserRepository.java`, `TaskRepository.java`, `UserTokenRepository.java`
- **Service**: `UserService.java`, `TaskService.java`
- **Controller**: `AuthController.java`, `UserController.java`, `TaskController.java`
- **DTO**: `LoginRequest.java`, `RegisterRequest.java`, `UserInfoResponse.java`, `TaskRequest.java`, `TaskResponse.java`
- **工具类**: `JwtUtil.java`, `IdGenerator.java`
- **公共类**: `ApiResponse.java`
- **异常处理**: `GlobalExceptionHandler.java`

## 部署步骤

### 第一步：准备环境

1. **安装JDK 17+**
   ```bash
   java -version  # 验证版本
   ```

2. **安装Maven 3.6+**
   ```bash
   mvn -version  # 验证版本
   ```

3. **安装MySQL 8.0+**
   ```bash
   mysql --version  # 验证版本
   ```

### 第二步：创建数据库

1. 登录MySQL：
   ```bash
   mysql -u root -p
   ```

2. 执行初始化脚本：
   ```sql
   source database/init.sql
   ```
   或
   ```bash
   mysql -u root -p < database/init.sql
   ```

### 第三步：配置项目

1. **修改数据库配置**
   
   编辑 `src/main/resources/application.yml`：
   ```yaml
   spring:
     datasource:
       url: jdbc:mysql://localhost:3306/work_order_system?...
       username: root
       password: 你的MySQL密码  # 修改这里
   ```

2. **修改JWT密钥**
   
   编辑 `src/main/resources/application.yml`：
   ```yaml
   jwt:
     secret: 你的安全密钥  # 修改为强随机字符串
     expiration: 86400000
   ```

3. **配置CORS（如果需要）**
   
   编辑 `src/main/java/com/example/workordersystem/config/WebConfig.java`：
   ```java
   .allowedOrigins("http://localhost:3000")  // 修改为你的前端地址
   ```

### 第四步：编译和运行

1. **编译项目**
   ```bash
   mvn clean compile
   ```

2. **运行项目**
   ```bash
   mvn spring-boot:run
   ```

3. **打包项目**
   ```bash
   mvn clean package
   ```

4. **运行JAR包**
   ```bash
   java -jar target/work-order-system-1.0.0.jar
   ```

### 第五步：验证部署

1. 访问健康检查（如果有）：
   ```
   http://localhost:8080/api
   ```

2. 测试注册接口：
   ```bash
   curl -X POST http://localhost:8080/api/auth/register \
     -H "Content-Type: application/json" \
     -d '{
       "username": "testuser",
       "phone": "13800138000",
       "password": "password123"
     }'
   ```

## 与HarmonyOS前端对接

### 1. 修改前端配置

编辑HarmonyOS项目中的 `CommonConstant.ets`：
```typescript
export const BASE_URL = 'http://你的服务器IP:8080/api';
```

### 2. 测试连接

使用前端应用测试登录、注册等功能。

## 生产环境部署建议

### 1. 使用Nginx反向代理

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location /api {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### 2. 使用HTTPS

配置SSL证书，使用HTTPS协议。

### 3. 数据库优化

- 配置数据库连接池
- 添加数据库索引
- 定期备份数据

### 4. 日志管理

- 配置日志文件输出
- 使用日志收集工具（如ELK）

### 5. 监控和告警

- 添加应用监控（如Prometheus）
- 配置告警规则

## 常见问题排查

### 问题1：数据库连接失败

**检查项：**
- MySQL服务是否启动
- 数据库用户名密码是否正确
- 数据库是否已创建
- 防火墙是否开放3306端口

### 问题2：端口被占用

**解决方案：**
```bash
# 查找占用8080端口的进程
netstat -ano | findstr :8080  # Windows
lsof -i :8080  # Linux/Mac

# 修改application.yml中的端口
server:
  port: 8081
```

### 问题3：JWT Token验证失败

**检查项：**
- Token是否过期
- JWT密钥是否一致
- Token格式是否正确（Bearer token）

### 问题4：CORS跨域问题

**解决方案：**
在 `WebConfig.java` 中配置允许的前端地址。

## 性能优化建议

1. **数据库连接池**
   - 已配置HikariCP连接池
   - 可根据实际情况调整连接数

2. **缓存**
   - 可以添加Redis缓存用户信息和Token
   - 缓存热点数据

3. **分页查询**
   - 所有列表查询都支持分页
   - 避免一次性加载大量数据

4. **索引优化**
   - 数据库表已添加必要索引
   - 根据查询情况添加更多索引

## 安全建议

1. **密码安全**
   - 使用BCrypt加密（已实现）
   - 前端传输使用HTTPS

2. **JWT安全**
   - 使用强随机密钥
   - 设置合理的过期时间
   - 考虑刷新Token机制

3. **SQL注入防护**
   - 使用JPA参数化查询（已实现）
   - 避免拼接SQL

4. **XSS防护**
   - 对用户输入进行验证和转义
   - 使用Content Security Policy

## 技术支持

如有问题，请查看：
- `README.md` - 项目说明文档
- `MySQL数据库设计文档.md` - 数据库设计文档
- API接口文档 - 在README.md中

