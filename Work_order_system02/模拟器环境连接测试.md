# 模拟器环境连接测试指南

## ✅ 配置确认

**BASE_URL配置：** `http://10.0.2.2:8080/api` ✅ 正确（模拟器环境）

**网络权限：** 已配置 ✅

**CORS配置：** 后端已允许所有来源 ✅

---

## 🔍 问题诊断步骤

### 步骤1：确认后端服务运行状态

**1.1 检查后端是否启动**
```bash
# 在Java目录下
cd Java
mvn spring-boot:run
```

**后端启动成功的标志：**
```
Started WorkOrderSystemApplication in X.XXX seconds
Tomcat started on port(s): 8080 (http)
```

**1.2 测试后端接口（在电脑浏览器中）**
打开浏览器，访问：
```
http://localhost:8080/api/user/user_1234567890_abc12345
```

**预期结果：**
- 如果返回JSON数据（即使是错误信息），说明后端正常运行 ✅
- 如果无法访问，说明后端未启动 ❌

---

### 步骤2：在模拟器中测试网络连接

**2.1 查看应用日志**
运行HarmonyOS应用，尝试创建工单，查看DevEco Studio的Log窗口。

**关键日志检查：**

**如果请求发送成功，应该看到：**
```
HttpUtil.request: 准备发送请求 - POST http://10.0.2.2:8080/api/task/create
HttpUtil.request: BASE_URL = http://10.0.2.2:8080/api, 完整URL = http://10.0.2.2:8080/api/task/create
HttpUtil.request: 请求头信息: {...}
HttpUtil.request: 请求体: {...}
HttpUtil.request: 开始发送HTTP请求，超时时间: 10000ms
HttpUtil.request: HTTP请求已发送，等待响应...
```

**如果连接失败，可能看到：**
```
HttpUtil.request: 请求失败 {"code":"ECONNREFUSED",...}
HttpUtil.request: 连接被拒绝 - 后端服务可能未启动或地址错误
```

或

```
HttpUtil.request: 请求失败 {"code":"timeout",...}
HttpUtil.request: 请求超时 - 请检查：1.后端服务是否运行 2.网络连接 3.BASE_URL配置是否正确
```

---

### 步骤3：检查后端日志

**在后端控制台查看：**
- 是否有请求到达后端？
- 是否有错误日志？

**如果后端没有收到任何请求：**
- 说明请求根本没有发送出去
- 或者请求发送到了错误的地址

**如果后端收到请求但返回错误：**
- 查看具体的错误信息
- 可能是认证、参数等问题

---

## 🛠️ 常见问题及解决方案

### 问题1：后端服务未启动

**症状：**
- 浏览器无法访问 `http://localhost:8080/api`
- 应用日志显示连接被拒绝

**解决：**
```bash
cd Java
mvn spring-boot:run
```

### 问题2：后端服务运行但模拟器无法连接

**可能原因：**
1. 后端服务没有绑定到所有网络接口
2. 防火墙阻止了连接

**检查方法：**
在电脑浏览器中测试：
```
http://127.0.0.1:8080/api
http://localhost:8080/api
```

**解决：**
确保后端服务绑定到 `0.0.0.0` 或所有接口（Spring Boot默认应该可以）

### 问题3：请求发送但超时

**症状：**
- 日志显示请求已发送
- 但10秒后超时

**可能原因：**
- 后端响应太慢
- 网络延迟

**解决：**
1. 检查后端日志，看是否收到请求
2. 增加超时时间（不推荐，应该找出慢的原因）

### 问题4：请求根本没有发送

**症状：**
- 日志中没有 "HttpUtil.request: 准备发送请求" 的日志
- 或者日志在发送前就停止了

**可能原因：**
- 代码执行到发送请求前就出错了
- token恢复失败导致提前返回

**检查：**
查看日志中是否有：
```
DataModel.addData: 开始添加工单: xxx
DataModel.addData: 已从session恢复token
DataModel.addData: 发送API请求，数据: {...}
```

---

## 📋 测试清单

请按照以下步骤测试并记录结果：

### 测试1：后端服务测试
- [ ] 后端服务已启动
- [ ] 浏览器可以访问 `http://localhost:8080/api`
- [ ] 后端控制台显示服务运行在8080端口

### 测试2：应用登录测试
- [ ] 应用可以正常启动
- [ ] 可以成功登录
- [ ] 登录日志显示获取到token

### 测试3：创建工单测试
- [ ] 点击"添加工单"按钮
- [ ] 输入工单名称
- [ ] 点击确定
- [ ] 查看日志输出

**关键日志检查：**
- [ ] 是否有 "DataModel.addData: 开始添加工单" 日志
- [ ] 是否有 "DataModel.addData: 已从session恢复token" 日志
- [ ] 是否有 "HttpUtil.request: 准备发送请求" 日志
- [ ] 是否有 "HttpUtil.request: HTTP请求已发送" 日志
- [ ] 是否有错误日志

### 测试4：后端日志检查
- [ ] 后端控制台是否显示收到请求
- [ ] 如果有请求，请求的URL是什么
- [ ] 如果有错误，错误信息是什么

---

## 🎯 请提供以下信息

1. **后端服务状态：**
   - 后端是否正在运行？ ✅ / ❌
   - 浏览器访问 `http://localhost:8080/api` 是否有响应？ ✅ / ❌

2. **应用日志（创建工单时）：**
   请复制从点击"确定"按钮开始的所有日志，特别是：
   - `DataModel.addData` 相关的日志
   - `HttpUtil.request` 相关的日志
   - 任何错误日志

3. **后端日志：**
   - 创建工单时，后端控制台是否有新的日志？
   - 如果有，日志内容是什么？

4. **具体现象：**
   - 点击"确定"后，界面有什么反应？
   - 是否有错误提示？
   - 工单是否出现在列表中？

---

## 💡 快速测试方法

**最简单的方法：**

1. **确认后端运行：**
   ```bash
   # 在Java目录
   mvn spring-boot:run
   ```
   看到 "Started WorkOrderSystemApplication" 说明启动成功

2. **测试后端接口：**
   浏览器访问：`http://localhost:8080/api/user/user_1234567890_abc12345`
   应该返回JSON数据

3. **运行应用并查看日志：**
   - 启动应用
   - 登录
   - 尝试创建工单
   - 查看DevEco Studio的Log窗口

4. **对比前后端日志：**
   - 前端日志显示请求发送了吗？
   - 后端日志显示收到请求了吗？

如果前端显示发送了，但后端没收到，可能是网络配置问题。
如果前端都没发送，可能是代码逻辑问题。








