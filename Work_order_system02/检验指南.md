# 工单系统检验指南

## 📋 检验步骤清单

### 第一步：检验数据库

#### 1.1 检查MySQL服务是否运行
```bash
# Windows
net start MySQL80
# 或查看服务状态
services.msc  # 在服务列表中找到MySQL服务

# Linux/Mac
sudo systemctl status mysql
# 或
sudo service mysql status
```

#### 1.2 连接MySQL并检查数据库
```bash
# 登录MySQL
mysql -u root -p

# 在MySQL命令行中执行以下SQL语句：
```

```sql
-- 1. 查看所有数据库，确认 work_order_system 存在
SHOW DATABASES;

-- 2. 使用 work_order_system 数据库
USE work_order_system;

-- 3. 查看所有表，确认 users、tasks、user_tokens 表存在
SHOW TABLES;

-- 4. 检查表结构
DESCRIBE users;
DESCRIBE tasks;
DESCRIBE user_tokens;

-- 5. 查看表中是否有数据（应该为空，除非你插入了测试数据）
SELECT COUNT(*) FROM users;
SELECT COUNT(*) FROM tasks;
SELECT COUNT(*) FROM user_tokens;
```

**预期结果：**
- ✅ 数据库 `work_order_system` 存在
- ✅ 表 `users`、`tasks`、`user_tokens` 都存在
- ✅ 表结构正确（有正确的字段）

---

### 第二步：检验后端服务

#### 2.1 检查后端配置
打开文件：`Java/src/main/resources/application.yml`

确认以下配置：
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/work_order_system?...
    username: root
    password: 951236  # 确保这是你的MySQL密码
server:
  port: 8080
  servlet:
    context-path: /api
```

#### 2.2 启动后端服务
```bash
# 进入Java目录
cd Java

# 使用Maven启动
mvn spring-boot:run

# 或先打包再运行
mvn clean package
java -jar target/work-order-system-1.0.0.jar
```

#### 2.3 检查启动日志
启动成功后，你应该看到类似以下的日志：
```
Started WorkOrderSystemApplication in X.XXX seconds
Tomcat started on port(s): 8080 (http)
```

**如果看到数据库连接错误：**
- 检查MySQL服务是否运行
- 检查数据库用户名和密码是否正确
- 检查数据库 `work_order_system` 是否存在

---

### 第三步：检验API接口

#### 3.1 使用浏览器测试（简单测试）
打开浏览器，访问：
```
http://localhost:8080/api/user/user_1234567890_abc12345
```

**预期结果：**
- 如果返回JSON数据（即使是错误信息），说明后端服务正常运行
- 如果无法访问，检查后端是否启动

#### 3.2 使用Postman或IDEA HTTP Client测试

**方法1：使用IDEA HTTP Client**
1. 打开文件：`Java/http-requests.http`
2. 在IDEA中直接运行这些请求

**方法2：使用Postman**
按照以下步骤测试：

**测试1：用户注册**
```
POST http://localhost:8080/api/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "phone": "13800138000",
  "password": "password123"
}
```

**预期响应：**
```json
{
  "code": 200,
  "message": "注册成功",
  "data": {
    "id": "user_xxx",
    "username": "testuser",
    "phone": "13800138000",
    "token": "jwt_token_here"
  }
}
```

**测试2：用户登录**
```
POST http://localhost:8080/api/auth/login
Content-Type: application/json

{
  "account": "testuser",
  "password": "password123",
  "rememberMe": false
}
```

**预期响应：**
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "id": "user_xxx",
    "username": "testuser",
    "phone": "13800138000",
    "token": "jwt_token_here"
  }
}
```

**⚠️ 重要：复制返回的 token 值，用于后续测试**

**测试3：创建工单（需要Token）**
```
POST http://localhost:8080/api/task/create
Authorization: Bearer {刚才复制的token}
Content-Type: application/json

{
  "taskName": "测试工单",
  "description": "这是一个测试工单",
  "progressValue": 0,
  "status": "pending",
  "priority": "medium"
}
```

**预期响应：**
```json
{
  "code": 200,
  "message": "创建成功",
  "data": {
    "id": "task_xxx",
    "taskName": "测试工单",
    "description": "这是一个测试工单",
    "progressValue": 0,
    "status": "pending",
    "priority": "medium"
  }
}
```

**测试4：获取工单列表（需要Token）**
```
GET http://localhost:8080/api/task/list
Authorization: Bearer {刚才复制的token}
```

**预期响应：**
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "list": [
      {
        "id": "task_xxx",
        "taskName": "测试工单",
        ...
      }
    ],
    "total": 1
  }
}
```

---

### 第四步：检验前端应用

#### 4.1 检查前端配置
打开文件：`entry/src/main/ets/common/constants/CommonConstant.ets`

确认 `BASE_URL` 配置：
```typescript
// 如果HarmonyOS应用运行在本地模拟器
export const BASE_URL = 'http://10.0.2.2:8080/api';

// 如果HarmonyOS应用运行在真机上，使用电脑的局域网IP
// 例如：export const BASE_URL = 'http://192.168.1.100:8080/api';
```

**如何获取电脑的局域网IP：**
- Windows: 打开命令提示符，输入 `ipconfig`，查找 "IPv4 地址"
- Linux/Mac: 打开终端，输入 `ifconfig` 或 `ip addr`

#### 4.2 在HarmonyOS应用中测试

**测试流程：**
1. **启动应用**
   - 运行HarmonyOS应用
   - 查看启动日志，确认没有连接错误

2. **注册/登录**
   - 在登录页面注册新用户或登录已有用户
   - 查看日志，确认登录成功并获取到token

3. **创建工单**
   - 在主页面点击"添加工单"按钮
   - 输入工单名称，点击确定
   - 查看日志，确认创建成功

4. **查看工单列表**
   - 在主页面应该能看到创建的工单
   - 如果列表为空，检查日志中的错误信息

#### 4.3 查看应用日志
在DevEco Studio的Log窗口中，查找以下关键日志：

**成功日志示例：**
```
HttpUtil.request: POST http://10.0.2.2:8080/api/task/create
HttpUtil.request: 请求头包含Authorization: Bearer eyJhbGc...
HttpUtil.request: 响应状态码 200, 数据: {"code":200,"message":"创建成功",...}
DataModel.addData: 工单创建成功
```

**错误日志示例：**
```
HttpUtil.request: 响应状态码 200, 数据: {"code":401,"message":"未授权，请先登录"}
DataModel.addData: 创建工单失败，响应码: 401
```

---

## 🔍 常见问题排查

### 问题1：数据库连接失败
**症状：** 后端启动时提示数据库连接错误

**解决方法：**
1. 检查MySQL服务是否运行
2. 检查 `application.yml` 中的数据库配置
3. 确认数据库 `work_order_system` 已创建
4. 测试MySQL连接：
   ```bash
   mysql -u root -p -h localhost
   ```

### 问题2：401未授权错误
**症状：** 创建工单时返回401错误

**解决方法：**
1. 确认登录成功并获取到token
2. 检查token是否正确设置到请求头
3. 查看日志中是否有 "请求头包含Authorization" 的日志
4. 确认token没有过期（默认24小时）

### 问题3：前端无法连接后端
**症状：** 网络请求失败或超时

**解决方法：**
1. **模拟器环境：**
   - 使用 `http://10.0.2.2:8080/api`（10.0.2.2是模拟器访问宿主机的特殊地址）

2. **真机环境：**
   - 确保手机和电脑在同一局域网
   - 使用电脑的局域网IP，例如：`http://192.168.1.100:8080/api`
   - 检查防火墙是否阻止了8080端口

3. **测试连接：**
   - 在手机浏览器中访问：`http://你的IP:8080/api/user/user_1234567890_abc12345`
   - 如果能看到JSON响应，说明网络连接正常

### 问题4：工单列表为空
**症状：** 登录后看不到工单

**解决方法：**
1. 确认已成功创建工单（查看日志）
2. 检查数据库 `tasks` 表中是否有数据：
   ```sql
   SELECT * FROM tasks;
   ```
3. 确认工单的 `user_id` 与当前登录用户的 `id` 匹配

---

## ✅ 完整检验清单

按照以下顺序检验，每项都通过后，系统应该可以正常使用：

- [ ] **数据库检验**
  - [ ] MySQL服务运行正常
  - [ ] 数据库 `work_order_system` 存在
  - [ ] 表 `users`、`tasks`、`user_tokens` 都存在
  - [ ] 表结构正确

- [ ] **后端服务检验**
  - [ ] 后端服务启动成功
  - [ ] 没有数据库连接错误
  - [ ] 服务运行在 `http://localhost:8080/api`

- [ ] **API接口检验**
  - [ ] 用户注册接口正常
  - [ ] 用户登录接口正常
  - [ ] 创建工单接口正常（需要token）
  - [ ] 获取工单列表接口正常（需要token）

- [ ] **前端应用检验**
  - [ ] 应用可以正常启动
  - [ ] 可以成功注册/登录
  - [ ] 可以成功创建工单
  - [ ] 可以正常显示工单列表

---

## 📝 检验结果记录

检验完成后，记录以下信息：

**数据库信息：**
- MySQL版本：_______
- 数据库名称：work_order_system
- 表数量：_______

**后端信息：**
- 启动端口：8080
- 启动状态：✅ 正常 / ❌ 异常
- 异常信息：_______

**API测试结果：**
- 注册接口：✅ / ❌
- 登录接口：✅ / ❌
- 创建工单：✅ / ❌
- 获取列表：✅ / ❌

**前端测试结果：**
- 应用启动：✅ / ❌
- 用户登录：✅ / ❌
- 创建工单：✅ / ❌
- 显示列表：✅ / ❌

---

如果所有检验都通过，但仍有问题，请提供：
1. 具体的错误日志
2. 操作步骤
3. 预期结果 vs 实际结果



