# 前端连接服务器配置说明

## 📍 当前状态

**当前配置：** `entry/src/main/ets/common/constants/CommonConstant.ets`
```typescript
export const BASE_URL = 'http://10.0.2.2:8080/api';
```

**问题：** 这个配置只能用于：
- ✅ HarmonyOS模拟器访问本地开发机
- ❌ **无法连接到阿里云服务器**

---

## 🔧 如何修改为服务器地址

### 步骤1：获取服务器地址

**方法1：从阿里云控制台获取**
1. 登录阿里云控制台：https://ecs.console.aliyun.com
2. 进入ECS实例列表
3. 找到你的服务器实例
4. 查看"公网IP"或"弹性公网IP"

**方法2：从部署文档中查找**
- 查看 `Java/部署配置检查清单.md` 中的"服务器IP"字段

### 步骤2：修改BASE_URL配置

编辑文件：`entry/src/main/ets/common/constants/CommonConstant.ets`

**修改前：**
```typescript
export const BASE_URL = 'http://10.0.2.2:8080/api';
```

**修改后（替换为你的服务器IP）：**
```typescript
export const BASE_URL = 'http://你的服务器IP:8080/api';
// 例如：export const BASE_URL = 'http://47.xxx.xxx.xxx:8080/api';
```

### 步骤3：验证配置

1. **确认服务器端口：** 默认是 `8080`，如果不同请修改
2. **确认后端服务运行：** 在浏览器访问 `http://你的服务器IP:8080/api` 应该有响应
3. **重新编译应用：** 修改配置后需要重新编译HarmonyOS应用

---

## 🧪 测试连接

### 方法1：浏览器测试（最简单）

在电脑浏览器中访问：
```
http://你的服务器IP:8080/api/user/user_1234567890_abc12345
```

**预期结果：**
- ✅ 返回JSON数据 → 服务器正常，可以修改前端配置
- ❌ 无法访问 → 检查服务器防火墙、安全组配置

### 方法2：应用内测试

1. 修改 `BASE_URL` 为服务器地址
2. 重新编译并运行应用
3. 尝试登录或创建工单
4. 查看应用日志，应该看到：
   ```
   HttpUtil.request: 准备发送请求 - POST http://你的服务器IP:8080/api/...
   HttpUtil.request: 响应状态码 200
   ```

---

## ⚠️ 注意事项

### 1. 服务器安全组配置

确保阿里云安全组已开放8080端口：
- 端口范围：8080/8080
- 授权对象：0.0.0.0/0（或限制特定IP）
- 协议类型：TCP

### 2. 服务器防火墙配置

确保服务器防火墙已开放8080端口：
```bash
# CentOS/RHEL
firewall-cmd --list-ports  # 查看已开放端口
firewall-cmd --permanent --add-port=8080/tcp
firewall-cmd --reload

# Ubuntu/Debian
ufw status
ufw allow 8080/tcp
```

### 3. 后端服务状态

确保后端服务正在运行：
```bash
# 在服务器上执行
systemctl status work-order-system
# 或
curl http://localhost:8080/api
```

### 4. HTTPS配置（可选）

如果服务器配置了HTTPS，需要修改为：
```typescript
export const BASE_URL = 'https://你的服务器IP:8080/api';
// 或使用域名
export const BASE_URL = 'https://api.yourdomain.com/api';
```

---

## 📋 快速检查清单

- [ ] 已获取服务器公网IP地址
- [ ] 已修改 `CommonConstant.ets` 中的 `BASE_URL`
- [ ] 浏览器可以访问 `http://你的服务器IP:8080/api`
- [ ] 服务器安全组已开放8080端口
- [ ] 服务器防火墙已开放8080端口
- [ ] 后端服务正在运行
- [ ] 已重新编译HarmonyOS应用
- [ ] 应用可以成功连接到服务器

---

## 🎯 下一步

1. **提供服务器IP地址**，我会帮你修改配置
2. **或者** 按照上述步骤自行修改 `BASE_URL`
3. **测试连接**，确认前端可以正常访问后端API

---

## 💡 常见问题

### Q1: 修改后仍然无法连接？

**检查：**
1. 服务器IP是否正确
2. 端口号是否正确（默认8080）
3. 服务器安全组是否开放端口
4. 后端服务是否正在运行

### Q2: 连接超时？

**可能原因：**
- 网络延迟
- 服务器响应慢
- 防火墙阻止

**解决：**
- 检查服务器状态
- 增加超时时间（不推荐）
- 检查网络连接

### Q3: 如何同时支持本地开发和服务器？

可以创建环境配置文件，根据编译模式选择不同的BASE_URL。

---

**最后更新：** 请根据实际服务器地址修改配置



